/*
*	MagnetiqJS
*	Updated On: 08/11/2021
*	By Fatih KAZANCI
*   Licenced By GNU General Public License v3.0
*   https://github.com/fatihkazanci/magnetiqJS/blob/main/LICENSE
*/
var magnetiq=function(){var eventAttributes={forEach:"mq-for",forEachSort:"mq-sort",if:"mq-if",root:""},regex=/{{(.*?)}}/,vRegex=/{{(.*?)}}/g;let obj={$var:{}},listForEach=[],listVariables=[],listIf=[];var baseHtmlString=String(stripScripts(document.body.innerHTML)),searchDoc=document.createElement("div"),validator={get:(e,r)=>"object"==typeof e[r]&&null!==e[r]?new Proxy(e[r],validator):e[r],set:(e,r,t)=>(e[r]=t,detectForEach(r),detectVaribles(r,t),!0)},mq=new Proxy(obj,validator),newGuid=function(){function e(e){var r=(Math.random().toString(16)+"000000000").substr(2,8);return e?"-"+r.substr(0,4)+"-"+r.substr(4,4):r}return e()+e(!0)+e(!0)+e()},dynamicSort=function(e){var r=1;return"-"===e[0]&&(r=-1,e=e.substr(1)),function(t,a){return(t[e]<a[e]?-1:t[e]>a[e]?1:0)*r}};function stripScripts(e){var r=document.createElement("div");r.innerHTML=e;for(var t=r.getElementsByTagName("script"),a=t.length;a--;)t[a].parentNode.removeChild(t[a]);return r.innerHTML}var getForEachElements=function(){document.querySelectorAll(eventAttributes.root+"["+eventAttributes.forEach+"]").forEach(function(e,r,t){var a=e.getAttribute(eventAttributes.forEach),n={name:a,listName:a.split(" in ")[1].trim()};null==listForEach.find(function(e,r,t){if(e.name==a)return!0})&&listForEach.push(n)})},getVariableElements=function(){var e=document.querySelector("body").innerText.match(vRegex);null!=e&&null!=e&&e.forEach(function(e,r,t){listVariables.push({name:e,guid:"mq-"+newGuid()})})},getIfElements=function(){var mqIfs=document.querySelectorAll("["+eventAttributes.if+"]");mqIfs.forEach(function(v,i,p){var currentOperator=v.getAttribute(eventAttributes.if),operatorValue=Boolean(eval(currentOperator+";"));operatorValue||v.remove(),listIf.push({element:v,operator:currentOperator})})},loop=function(doc,foreachString,currentListObj){var foreachArray=foreachString.split(" in "),foreachVariableName=foreachArray[0].trim(),currentVariableObj=doc.innerHTML,checkSortAttribute=doc.getAttribute(eventAttributes.forEachSort);if(null!=checkSortAttribute&&""!=checkSortAttribute){for(var sortAttributeArray=checkSortAttribute.split(":"),sortVariableNameArray=sortAttributeArray[0].split("."),sortVariableName="",index=1;index<sortVariableNameArray.length;index++)sortVariableName=sortVariableName+sortVariableNameArray[index]+".";sortVariableName=sortVariableName.substring(0,sortVariableName.length-1);var sortType=sortAttributeArray[1];switch(sortType){case"desc":""==sortVariableName&&null!=sortVariableName?currentListObj.sort().reverse():currentListObj.sort(dynamicSort("-"+sortVariableName));break;default:""==sortVariableName&&null!=sortVariableName?currentListObj.sort():currentListObj.sort(dynamicSort(sortVariableName))}}var currentListObjCounter=0,cloneDoc=doc.cloneNode(!0),returnDoc=doc.cloneNode(!0);return returnDoc.innerHTML="",doc.innerHTML="",null!=currentListObj&&currentListObj.forEach(function(currentValue,key,parent){if(null!=currentValue){searchDoc.innerHTML="",searchDoc.innerHTML=baseHtmlString;var subForeach=searchDoc.querySelectorAll("["+eventAttributes.forEach+"*='in "+foreachVariableName+".']");if(subForeach.length>0)for(var index=0;index<subForeach.length;index++){for(var subForSearchString=subForeach[index].getAttribute(eventAttributes.forEach),subForSearchListArray=String(subForSearchString).split(" in ")[1],subForSearchListNameArray=subForSearchListArray.split("."),subForSearchListName="",subindex=1;subindex<subForSearchListNameArray.length;subindex++)subForSearchListName=subForSearchListName+"['"+subForSearchListNameArray[subindex]+"']";var fixedCurrentValue=eval("currentValue"+subForSearchListName);if(null!=fixedCurrentValue){var returnedDoc=loop(subForeach[index],subForSearchString,fixedCurrentValue),tempCloneDoc=cloneDoc.querySelector("["+eventAttributes.forEach+"='"+subForSearchString+"']");tempCloneDoc.innerHTML=returnedDoc.innerHTML,currentVariableObj=cloneDoc.innerHTML}}var matches=currentVariableObj.matchAll(vRegex),matchList=[],matchValues=[];for(const e of matches){var currentMatchValue=e[1].trim();-1!=currentMatchValue.indexOf(foreachVariableName)&&matchList.push(currentMatchValue)}matchList.forEach(function(v,i,p){var newCurrentVariableArray=v.split("."),variablaName="",tempNewValue=null;if(newCurrentVariableArray.length>1){for(var i=1;i<newCurrentVariableArray.length;i++)variablaName=variablaName+newCurrentVariableArray[i].trim()+".";variablaName=variablaName.substring(0,variablaName.length-1),tempNewValue=eval("currentValue."+variablaName)}else variablaName=newCurrentVariableArray[0],tempNewValue=currentValue;matchValues.push(tempNewValue)});var newValue=currentVariableObj;matchValues.forEach(function(e,r,t){newValue=newValue.replace(regex,e)}),newValue=newValue.replace(/{{(.*?)\$index(.*?)}}/,currentListObjCounter),doc.insertAdjacentHTML("beforeend",newValue),returnDoc.insertAdjacentHTML("beforeend",newValue),currentListObjCounter+=1}}),returnDoc},detectForEach=function(key){var forEachKey=listForEach.find(function(e,r,t){if(e.listName==key)return!0});if(null!=forEachKey){var doc=document.querySelector("["+eventAttributes.forEach+"='"+forEachKey.name+"']"),docVariableObj=eval("obj.$var."+forEachKey.listName);loop(doc,forEachKey.name,docVariableObj)}},detectVaribles=function(key,value){var bb=listVariables.filter(function(v,i,p){if(-1!=String(v.name).indexOf(key)){value=eval("mq.$var."+v.name.replace("{{","").replace("}}",""));var queryString="."+v.guid,listClass=document.querySelectorAll(queryString);return listClass.length>0&&listClass.forEach(function(e,r,t){e.innerHTML=value}),document.body.innerHTML=document.body.innerHTML.replace(new RegExp(""+v.name,"g"),'<span class="'+v.guid+'">'+value+"</span>"),!0}})};return getForEachElements(),getVariableElements(),getIfElements(),mq};